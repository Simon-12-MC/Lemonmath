<script>
// === LIVE COUNTER FIX ===
// Smooth fake counter that feels alive (randomly fluctuates)
const playerCountEl = document.getElementById("playerCount");
let basePlayers = Math.floor(Math.random() * 30) + 15; // Start between 15–45
let displayedPlayers = basePlayers;

// Update the displayed counter smoothly
function updateCounter() {
  const change = Math.floor(Math.random() * 5) - 2; // fluctuate -2 to +2
  displayedPlayers = Math.max(1, displayedPlayers + change);
  playerCountEl.textContent = displayedPlayers.toLocaleString();
}

// Update every 2–5 seconds randomly
setInterval(updateCounter, Math.random() * 3000 + 2000);

// === FLOATING DOTS ===
const dots = [];
const numDots = 80; // fewer dots = less lag

for (let i = 0; i < numDots; i++) {
  const dot = document.createElement('div');
  dot.className = 'dot';
  const size = Math.random() * 3 + 2;
  dot.style.width = dot.style.height = size + 'px';
  dot.style.background = ['#fff', '#3cafff', '#ffd700'][Math.floor(Math.random() * 3)];
  document.body.appendChild(dot);
  dots.push({
    el: dot,
    x: Math.random() * window.innerWidth,
    y: Math.random() * window.innerHeight,
    vx: (Math.random() - 0.5) * 0.2,
    vy: (Math.random() - 0.5) * 0.2
  });
}

function animateDots() {
  for (const d of dots) {
    d.x += d.vx;
    d.y += d.vy;
    if (d.x < 0) d.x = window.innerWidth;
    if (d.x > window.innerWidth) d.x = 0;
    if (d.y < 0) d.y = window.innerHeight;
    if (d.y > window.innerHeight) d.y = 0;
    d.el.style.transform = `translate(${d.x}px, ${d.y}px)`;
  }
  requestAnimationFrame(animateDots);
}
animateDots();

// === PLAY BUTTON ===
const playBtn = document.getElementById("playBtn");
const menu = document.getElementById("menu");
const loadingDiv = document.getElementById("loading");
const gameFrame = document.getElementById("game_frame");

playBtn.addEventListener("click", () => {
  menu.classList.add("fade-out");
  dots.forEach(dot => dot.el.style.opacity = "0");

  setTimeout(() => {
    loadingDiv.style.display = "flex";
    setTimeout(() => {
      loadingDiv.style.display = "none";
      gameFrame.style.display = "flex";

      if (!window.eaglercraftXOpts) {
        window.eaglercraftXOpts = {
          container: "game_frame",
          assetsURI: "https://cdn.jsdelivr.net/gh/mece188/feh@main/assets.epk",
          localesURI: "lang/",
          servers: [
            { addr: "wss://mc.arch.lol/", name: "ArchMC" },
            { addr: "wss://mc.asspixel.net", name: "AssPixel" },
            { addr: "wss://sus.shhnowisnottheti.me", name: "Ayunboom" },
            { addr: "wss://aeon-network.net/1.8", name: "Aeon" },
            { addr: "wss://zentic.org/", name: "Zentic" }
          ]
        };
      }

      try {
        main();
      } catch (e) {
        console.error("Error starting EaglercraftX:", e);
      }
    }, 3000);
  }, 500);
});
</script>
